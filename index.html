<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Modelos Probabilistas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .result-box { background-color: #e9ecef; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        #network-visualization, #markov-graph { min-height: 300px; background: white; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container pb-5">
        <h1 class="text-center mb-4">Inferencia Probabilista</h1>
        
        <div class="row">
            <div class="col-md-5">
                <div class="card p-3">
                    <h5 class="card-title">Configuración del Modelo</h5>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">1. Seleccionar Modelo</label>
                        <select id="model_select" class="form-select" onchange="toggleInputs()">
                            <option value="markov">Cadenas de Markov (CM)</option>
                            <option value="hmm">Modelos Ocultos (HMM)</option>
                            <option value="bayesian">Redes Bayesianas (RB)</option>
                        </select>
                    </div>

                    <div id="matrix-setup-container">
                        <div class="mb-3">
                            <label class="form-label fw-bold text-primary">Nombres de los Estados (Opcional)</label>
                            <input type="text" id="state_names" class="form-control form-control-sm" 
                                   placeholder="Ej: Soleado, Nublado, Lluvioso">
                            <div class="form-text">Sepáralos por comas. Si lo dejas vacío, se usará E0, E1...</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Matriz de Transición (A)</label>
                            <textarea id="text_matrix_a" class="form-control" rows="5" placeholder="0.7 0.3&#10;0.4 0.6"></textarea>
                        </div>
                    </div>

                    <div id="hmm-inputs" style="display:none;">
                        <div class="mb-3">
                            <label class="form-label">Matriz de Emisión (B)</label>
                            <textarea id="text_matrix_b" class="form-control" rows="5" placeholder="0.6 0.3 0.1&#10;0.1 0.4 0.5"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Vector Inicial (π)</label>
                            <textarea id="text_vector_pi" class="form-control" rows="1" placeholder="0.5 0.5"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-danger">Observaciones</label>
                            <input type="text" id="observations" class="form-control" placeholder="Ej: Mareado, Frio, Mareado">
                            <div class="form-text">Usa los nombres de las columnas de B o sus índices (0, 1...).</div>
                        </div>
                    </div>

                    <div id="bayesian-inputs" style="display:none;">
                        <div class="mb-3">
                            <label class="form-label">Definición JSON de la Red</label>
                            <textarea id="bayesian_json" class="form-control" rows="8" placeholder='{"nodes": [...], "structure": {...}}'></textarea>
                            <button class="btn btn-sm btn-outline-secondary mt-2" onclick="loadBayesianNetworkFromJSON()">Cargar Red</button>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Query (Q)</label>
                            <select id="rb_query" class="form-select"></select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Evidencia (E)</label>
                            <div id="evidence-container"></div>
                            <button class="btn btn-sm btn-outline-primary mt-2" onclick="addEvidenceRow()">+ Agregar Evidencia</button>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Método</label>
                            <select id="rb_method" class="form-select">
                                <option value="enumeration">Enumeración (Exacta)</option>
                                <option value="variable_elimination">Eliminación de Variables</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-success w-100 fw-bold mt-3" onclick="performCalculation()">Calcular y Graficar</button>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card p-3">
                    <h5 class="card-title">Resultados Numéricos</h5>
                    <div id="output_result" class="result-box">Esperando datos...</div>
                </div>

                <div class="card p-3" id="cm-visualization">
                    <h5 class="card-title">Grafo de Estados</h5>
                    <div id="markov-graph" class="d-flex justify-content-center align-items-center"></div>
                </div>
                
                <div class="card p-3" id="bayesian-visualization" style="display:none;">
                    <h5 class="card-title">Estructura de la Red</h5>
                    <div id="network-visualization" class="d-flex justify-content-center align-items-center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>

    <script src="js/utils.js"></script>
    <script src="js/markov.js"></script>
    <script src="js/hmm.js"></script>
    <script src="js/bayesian.js"></script>
    <script src="js/visualization.js"></script> <script src="js/main.js"></script> </body>
</html>